<script type="text/html" data-help-name="loop">

</script>

<script type="text/html" data-template-name="loop">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span
                data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>

    <div class="form-row">
        <label for="node-input-type"><i class="fa fa-tasks"></i> Loop over:</label>
        <select id="node-input-type">
            <option value="numbers">Numbers</option>
            <option value="list">List</option>
        </select>
    </div>


    <div id="list-details">
        <div class="form-row">
            <label for="node-input-list"><i class="fa fa-tag"></i> List</label>
            <input type="text" id="node-input-list">
        </div>
    </div>

    <div id="numbers-details">
        <div class="form-row">
            <label for="node-input-from"><i class="fa fa-tag"></i> From</label>
            <input type="text" id="node-input-from">
        </div>
        <div class="form-row">
            <label for="node-input-skip"><i class="fa fa-tag"></i> Skip</label>
            <input type="text" id="node-input-skip">
        </div>
        <div class="form-row">
            <label for="node-input-to"><i class="fa fa-tag"></i> To</label>
            <input type="text" id="node-input-to">
        </div>
    </div>
</script>


<script type="text/javascript">
  RED.nodes.registerType('loop', {
    category: 'core',
    color: '#d4d4d9',
    defaults: { 
      name: { value: "" },
      list: { value: "" },
      from: { value: "0", required: true, validate: function (v) { return RED.validators.number(v) && (v >= 0) && (v < this.to); } },
      skip: { value: "1", required: true, validate: function (v) { return RED.validators.number(v) && (v >= 1); } },
      to: { value: "10", required: true, validate: function (v) { return RED.validators.number(v) && (v > this.from); } },
    },
    inputs: 1,
    outputs: 2,
    icon: "file.png",
    label: function () {
      return this.name || "loop";
    },
    paletteLabel: 'loop',
    outputLabels: ["i<n", "i=n"],
    oneditprepare: function () {
      var node = this;
      $("#node-input-type").val('numbers');

      $("#node-input-type").on("change", function () {
        if (this.value === "list") {
          $("#list-details").show();
          $("#numbers-details").hide();
        } else if (this.value === "numbers") {
          $("#list-details").hide();
          $("#numbers-details").show();
        }
      }).trigger("change");
    }
  });
</script>