<script type="text/html" data-help-name="browser">
    <p>Open a new browser session.
    </p>
</script>

<script type="text/html" data-template-name="browser">
    <style>
        .form-row.bsync-row > label {
            width: 80px;
        }

        .form-row.bsync-row > .bsync-override {
            width: 40px;
        }

        .form-row.bsync-row > .bsync-input {

        }
    </style>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row bsync-row">
        <label for="node-input-request"><i class="fa fa-tag"></i> Page ID</label>
        <input type="text" class="bsync-input" id="node-input-page" placeholder="PageId">
    </div>
    <div class="form-row bsync-row">
        <label for="node-input-request"><i class="fa fa-tag"></i> URL</label>
        <input type="text" class="bsync-input" id="node-input-url" placeholder="Url" required>
    </div>
</script>


<script type="text/javascript">
    function randomString() {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        const charactersLength = characters.length;
        for (let i = 0; i < 10; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
    }


    var urlRegex = new RegExp('^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$', 'i');

    RED.nodes.registerType('browser', {
        category: 'Playwright',
        color: '#a6bbcf',
        defaults: {
            name: { value: "", },
            page: { value: "" },
            url: { value: "", validate: RED.validators.regex(urlRegex, "Invalid URL") },
        },
        inputs: 1,
        outputs: 1,
        icon: "file.png",
        label: function () {
            return this.name || "Open Browser";
        },
        paletteLabel: 'Open Browser',
        oneditprepare: function () {
            var node = this;
            if ($('#node-input-page').val() === '') {
                $('#node-input-page').val(randomString());
            }
        },
    });
</script>