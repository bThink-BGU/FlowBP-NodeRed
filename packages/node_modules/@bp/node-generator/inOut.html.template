<script type="text/html" data-help-name="{{name}}">
    {{help}}
</script>

<script type="text/html" data-template-name="{{name}}">
    {{css}}

    {{sharedConfiguration}}

    {{configuration}}
</script>


<script type="text/javascript">
  function updateColor(type, id) {
    let color = '#87A980'; // request (default)
    if (type === "waitFor") {
      color = '#FFCC66'
    } else if (type === "block") {
      color = '#FFAAAA'
    }
    let path = "#" + id.replace(".", "\\.") + " > rect";
    $(path).css("fill", color)
  }

  function defaultTypeValue(type) {
    switch (type) {
      case "num":
        return 0;
      case "bool":
        return false;
      case "date":
        return "1900-01-01";
      case "select":
      case "multiSelect":
        return "select";
      default:
        return "tmp";
    }
  }

  function bpValidator(fieldName, R, v) {
    console.log(`1::: fieldName: ${fieldName}, R: ${R}, v: ${v}`);
    let eventType = $("#node-input-eventType").val() || this.eventType;
    console.log(`2::: eventType: ${eventType}`);
    if (eventType !== 'request') {
      return true;
    }
    console.log(`4::: type str: "#node-input-${fieldName}${R}Type"`);
    let type = $("#node-input-" + fieldName + R + "Type").val() || this[fieldName + R + "Type"];
    console.log(`4::: type: ${type}`);
    if (type === 'select') {
      if (R === 'R') {
        return v !== 'select';
      } else {
        return true;
      }
    } else if (type === 'multiSelect') {
      if (R === 'R') {
        return v.length > 0;
      } else {
        return true;
      }
    } else {
      return RED.validators.typedInput(fieldName + R + "Type", false)(v);
    }
  }

  RED.nodes.registerType('{{name}}', {
    category: '{{category}}',
    color: '{{color}}',
    defaults: {
      name: { value: "" },
      eventType: { value: "request" },
      {{defaults}}
    },
    inputs: {{numInput}},
    outputs: {{numOutput}},
    icon: "{{icon}}",
    label: {{label}},
    paletteLabel: '{{paletteLabel}}',
    outputLabels: {{outputLabels}},
    oneditprepare: function () {
      var that = this;
      {{oneditprepare}}
      if ($("#node-input-eventType").val() === 'request') {
        $(".sync-wd").hide();
        $(".sync-r").show();
      } else {
        $(".sync-r").hide();
        $(".sync-wd").show();
      }
    },
  });
</script>

